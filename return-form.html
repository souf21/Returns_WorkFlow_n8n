<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>TechShop – Demande de retour</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      max-width: 640px;
      margin: 40px auto;
      padding: 0 16px;
    }
    h1 { margin-bottom: 8px; }
    label { display:block; margin-top:14px; font-weight:600; }
    input, select, button {
      width:100%;
      padding:10px;
      margin-top:6px;
    }
    button {
      margin-top:20px;
      cursor:pointer;
      font-weight:600;
    }
    .status {
      margin-top:20px;
      white-space:pre-wrap;
      background:#f6f6f6;
      padding:12px;
      border-radius:6px;
    }
  </style>
</head>
<body>

<h1>Demande de retour</h1>
<p>Remplissez les informations ci-dessous.</p>

<label for="order_id">Numéro de commande</label>
<input id="order_id" required placeholder="ORD-2025-001" autocomplete="off">

<label for="customer_email">Email</label>
<input id="customer_email" type="email" required placeholder="john@example.com" autocomplete="email">

<label for="sku">Référence produit (SKU)</label>
<input id="sku" required placeholder="PROD-001" autocomplete="off">

<label for="reason">Motif du retour</label>
<select id="reason" required>
  <option value="Défectueux">Défectueux</option>
  <option value="Trop petit">Trop petit</option>
  <option value="Trop grand">Trop grand</option>
  <option value="Erreur commande">Erreur commande</option>
  <option value="Changement d'avis">Changement d'avis</option>
</select>

<label for="product_condition">État du produit</label>
<select id="product_condition" required>
  <option value="Comme neuf">Comme neuf</option>
  <option value="Bon">Bon</option>
  <option value="Endommagé">Endommagé</option>
</select>

<button id="submit" type="button">Envoyer</button>

<div id="result" class="status"></div>

<script>
  const WEBHOOK_URL = "http://localhost:5678/webhook-test/returns/intake";
  const TECHSHOP_TOKEN = "my_secret_token";

  const $ = (id) => document.getElementById(id);

  function requestId() {
    const d = new Date().toISOString().slice(0, 10).replace(/-/g, "");
    const r = Math.random().toString(36).slice(2, 8);
    return `req_${d}_${r}`;
  }

  $("submit").addEventListener("click", async () => {
    const result = $("result");
    result.textContent = "Envoi en cours...";

    const payload = {
      request_id: requestId(),
      created_at: new Date().toISOString(),
      channel: "contact_form",
      order_id: $("order_id").value.trim(),
      customer_email: $("customer_email").value.trim(),
      sku: $("sku").value.trim(),
      reason: $("reason").value,
      product_condition: $("product_condition").value
    };

    try {
      const res = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-techshop-token": TECHSHOP_TOKEN
        },
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      result.textContent = `HTTP ${res.status}\n\n${text}`;
    } catch (e) {
      result.textContent = `Erreur réseau : ${e.message}`;
    }
  });
</script>

</body>
</html>
