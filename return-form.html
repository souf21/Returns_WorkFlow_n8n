<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>TechShop ‚Äì Demande de retour</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      max-width: 640px;
      margin: 40px auto;
      padding: 0 16px;
    }
    h1 { margin-bottom: 8px; }
    label { display:block; margin-top:14px; font-weight:600; }
    input, select, button {
      width:100%;
      padding:10px;
      margin-top:6px;
    }
    button {
      margin-top:20px;
      cursor:pointer;
      font-weight:600;
    }
    .status {
      margin-top:20px;
      white-space:pre-wrap;
      background:#f6f6f6;
      padding:12px;
      border-radius:6px;
    }
  </style>
</head>
<body>

<h1>Demande de retour</h1>
<p>Merci de remplir ce formulaire pour demander un retour produit.</p>

<label>Num√©ro de commande</label>
<input id="order_id" required placeholder="ORD-2025-001">

<label>Email</label>
<input id="customer_email" type="email" required placeholder="john@example.com">

<label>R√©f√©rence produit (SKU)</label>
<input id="sku" required placeholder="PROD-001">

<label>Motif du retour</label>
<select id="reason" required>
  <option value="D√©fectueux">D√©fectueux</option>
  <option value="Trop petit">Trop petit</option>
  <option value="Trop grand">Trop grand</option>
  <option value="Erreur commande">Erreur commande</option>
  <option value="Changement d'avis">Changement d'avis</option>
</select>

<label>√âtat du produit</label>
<select id="product_condition" required>
  <option value="Comme neuf">Comme neuf</option>
  <option value="Bon">Bon</option>
  <option value="Endommag√©">Endommag√©</option>
</select>

<button id="submit">Envoyer la demande</button>

<div id="result" class="status"></div>

<script>
  // üîí Hidden constants (exam-friendly)
  const WEBHOOK_URL = "http://localhost:5678/webhook-test/returns/intake";
  const TECHSHOP_TOKEN = "my_secret_token";

  function generateRequestId() {
    return (
      "req_" +
      new Date().toISOString().slice(0, 10).replace(/-/g, "") +
      "_" +
      Math.random().toString(36).substring(2, 8)
    );
  }

  document.getElementById("submit").addEventListener("click", async () => {
    const payload = {
      request_id: generateRequestId(),
      created_at: new Date().toISOString(),
      channel: "contact_form",
      order_id: document.getElementById("order_id").value.trim(),
      customer_email: document.getElementById("customer_email").value.trim(),
      sku: document.getElementById("sku").value.trim(),
      reason: document.getElementById("reason").value,
      product_condition: document.getElementById("product_condition").value
    };

    const result = document.getElementById("result");
    result.textContent = "Envoi en cours...";

    try {
      const response = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-techshop-token": TECHSHOP_TOKEN
        },
        body: JSON.stringify(payload)
      });

      const text = await response.text();
      result.textContent = `HTTP ${response.status}\n\n${text}`;
    } catch (err) {
      result.textContent = "Erreur r√©seau : " + err.message;
    }
  });
</script>

</body>
</html>
